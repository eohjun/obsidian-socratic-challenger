/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var B=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var se=(a,s)=>{for(var e in s)B(a,e,{get:s[e],enumerable:!0})},ne=(a,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of ee(s))!te.call(a,n)&&n!==e&&B(a,n,{get:()=>s[n],enumerable:!(t=Z(s,n))||t.enumerable});return a};var ie=a=>ne(B({},"__esModule",{value:!0}),a);var fe={};se(fe,{default:()=>F});module.exports=ie(fe);var P=require("obsidian");var H=class{constructor(s){this.providers=new Map;this.settings=s}registerProvider(s,e){this.providers.set(s,e)}updateSettings(s){this.settings=s}getCurrentProvider(){return this.providers.get(this.settings.provider)}getCurrentApiKey(){return this.settings.apiKeys[this.settings.provider]}getCurrentModel(){return this.settings.models[this.settings.provider]}isAvailable(){let s=this.getCurrentProvider(),e=this.getCurrentApiKey();return!!s&&!!e}async generateText(s,e){let t=this.getCurrentProvider();return t?t.isAvailable()?t.generate(s,e):{success:!1,content:"",error:"API key is not configured."}:{success:!1,content:"",error:"No provider selected."}}async simpleGenerate(s,e,t){let n=[];return e&&n.push({role:"system",content:e}),n.push({role:"user",content:s}),this.generateText(n,t)}getAvailableProviders(){return Array.from(this.providers.keys())}isProviderConfigured(s){return!!this.settings.apiKeys[s]}},E=null;function j(a){return E=new H(a),E}function z(){return E}function W(a){E&&E.updateSettings(a)}var X=require("obsidian");var x={claude:{id:"claude",name:"Anthropic Claude",displayName:"Claude",endpoint:"https://api.anthropic.com/v1",defaultModel:"claude-sonnet-4-5-20250929"},gemini:{id:"gemini",name:"Google Gemini",displayName:"Gemini",endpoint:"https://generativelanguage.googleapis.com/v1beta",apiKeyPrefix:"AIza",defaultModel:"gemini-3-flash-preview"},openai:{id:"openai",name:"OpenAI",displayName:"OpenAI",endpoint:"https://api.openai.com/v1",apiKeyPrefix:"sk-",defaultModel:"gpt-5.2"},grok:{id:"grok",name:"xAI Grok",displayName:"Grok",endpoint:"https://api.x.ai/v1",defaultModel:"grok-4-1-fast"}},oe={"claude-sonnet-4-5-20250929":{id:"claude-sonnet-4-5-20250929",displayName:"Claude Sonnet 4.5",provider:"claude",maxTokens:16384},"claude-3-5-haiku-20241022":{id:"claude-3-5-haiku-20241022",displayName:"Claude 3.5 Haiku",provider:"claude",maxTokens:8192},"gemini-3-flash-preview":{id:"gemini-3-flash-preview",displayName:"Gemini 3 Flash",provider:"gemini",maxTokens:65536},"gemini-2.0-flash":{id:"gemini-2.0-flash",displayName:"Gemini 2.0 Flash",provider:"gemini",maxTokens:8192},"gpt-5.2":{id:"gpt-5.2",displayName:"GPT-5.2",provider:"openai",maxTokens:32768},"gpt-4o-mini":{id:"gpt-4o-mini",displayName:"GPT-4o Mini",provider:"openai",maxTokens:16384},"grok-4-1-fast":{id:"grok-4-1-fast",displayName:"Grok 4.1 Fast",provider:"grok",maxTokens:16384}};function J(a){return Object.values(oe).filter(s=>s.provider===a)}var I=class{constructor(){this.apiKey="";this.model=""}get modelId(){return this.model||this.config.defaultModel}get config(){return x[this.providerType]}setApiKey(s){this.apiKey=s}setModel(s){this.model=s}isAvailable(){return!!this.apiKey}async makeRequest(s){try{return(await(0,X.requestUrl)(s)).json}catch(e){throw this.normalizeError(e)}}handleError(s){return typeof s=="object"&&s!==null&&"message"in s&&"code"in s?{success:!1,content:"",error:s.message}:{success:!1,content:"",error:this.normalizeError(s).message}}normalizeError(s){return console.error("[Socratic Challenger] API Error:",s),s instanceof Error?s.message.includes("429")||s.message.includes("rate")?{message:"\uC694\uCCAD \uD55C\uB3C4\uB97C \uCD08\uACFC\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",code:"RATE_LIMIT"}:s.message.includes("401")||s.message.includes("403")?{message:"API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uAC70\uB098 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",code:"AUTH_ERROR"}:s.message.includes("timeout")||s.message.includes("ETIMEDOUT")?{message:"\uC694\uCCAD \uC2DC\uAC04\uC774 \uCD08\uACFC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",code:"TIMEOUT"}:{message:s.message,code:"UNKNOWN"}:{message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.",code:"UNKNOWN"}}async simpleGenerate(s,e,t){let n=[];return e&&n.push({role:"system",content:e}),n.push({role:"user",content:s}),this.generate(n,t)}};var L=class extends I{constructor(){super(...arguments);this.providerType="claude";this.name="Anthropic Claude";this.API_VERSION="2023-06-01"}async testApiKey(e){try{let t=await this.makeRequest({url:`${this.config.endpoint}/messages`,method:"POST",headers:{"x-api-key":e,"anthropic-version":this.API_VERSION,"Content-Type":"application/json"},body:JSON.stringify({model:this.config.defaultModel,messages:[{role:"user",content:"Hello"}],max_tokens:10})});return!t.error&&!!t.content}catch(t){return!1}}async generate(e,t){var r,c;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let{claudeMessages:n,systemPrompt:i}=this.convertMessages(e),o={model:this.modelId,messages:n,max_tokens:(r=t==null?void 0:t.maxTokens)!=null?r:4096,temperature:(c=t==null?void 0:t.temperature)!=null?c:.7};i&&(o.system=i),console.log("[Socratic Challenger] Claude API Request:",{model:this.modelId,messagesCount:n.length,hasSystemPrompt:!!i,maxTokens:o.max_tokens});try{let u=await this.makeRequest({url:`${this.config.endpoint}/messages`,method:"POST",headers:{"x-api-key":this.apiKey,"anthropic-version":this.API_VERSION,"Content-Type":"application/json"},body:JSON.stringify(o)});return u.error?{success:!1,content:"",error:u.error.message}:{success:!0,content:u.content.filter(g=>g.type==="text").map(g=>g.text).join(""),usage:u.usage?{inputTokens:u.usage.input_tokens,outputTokens:u.usage.output_tokens,totalTokens:u.usage.input_tokens+u.usage.output_tokens}:void 0}}catch(u){return this.handleError(u)}}convertMessages(e){let t=[],n=null;for(let i of e)i.role==="system"?n=i.content:t.push({role:i.role,content:i.content});return{claudeMessages:t,systemPrompt:n}}};var M=class extends I{constructor(){super(...arguments);this.providerType="openai";this.name="OpenAI"}async testApiKey(e){try{let t=this.config.defaultModel,n=t.startsWith("gpt-5")||t.startsWith("o1")||t.startsWith("o3"),i={model:t,messages:[{role:"user",content:"Hello"}]};n?i.max_completion_tokens=10:i.max_tokens=10;let o=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(i)});return!o.error&&o.choices&&o.choices.length>0}catch(t){return!1}}async generate(e,t){var r,c,u,h,g,p,v;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let n=e.map(d=>({role:d.role,content:d.content})),i=this.modelId.startsWith("gpt-5")||this.modelId.startsWith("o1")||this.modelId.startsWith("o3"),o={model:this.modelId,messages:n,temperature:(r=t==null?void 0:t.temperature)!=null?r:.7};i?o.max_completion_tokens=(c=t==null?void 0:t.maxTokens)!=null?c:4096:o.max_tokens=(u=t==null?void 0:t.maxTokens)!=null?u:4096,(t==null?void 0:t.topP)!==void 0&&(o.top_p=t.topP),t!=null&&t.stopSequences&&(o.stop=t.stopSequences),console.log("[Socratic Challenger] OpenAI API Request:",{model:this.modelId,isReasoningModel:i,messagesCount:n.length});try{let d=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(o)});return d.error?{success:!1,content:"",error:d.error.message}:{success:!0,content:(v=(p=(g=(h=d.choices)==null?void 0:h[0])==null?void 0:g.message)==null?void 0:p.content)!=null?v:"",usage:d.usage?{inputTokens:d.usage.prompt_tokens,outputTokens:d.usage.completion_tokens,totalTokens:d.usage.total_tokens}:void 0}}catch(d){return this.handleError(d)}}};var q=class extends I{constructor(){super(...arguments);this.providerType="gemini";this.name="Google Gemini"}async testApiKey(e){try{let t=this.config.defaultModel,n=`${this.config.endpoint}/models/${t}:generateContent?key=${e}`,i=await this.makeRequest({url:n,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:"Hello"}]}],generationConfig:{maxOutputTokens:10}})});return!i.error&&!!i.candidates&&i.candidates.length>0}catch(t){return!1}}async generate(e,t){var r,c,u,h,g,p,v;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let{contents:n,systemInstruction:i}=this.convertMessages(e),o={contents:n,generationConfig:{maxOutputTokens:(r=t==null?void 0:t.maxTokens)!=null?r:4096,temperature:(c=t==null?void 0:t.temperature)!=null?c:.7}};i&&(o.systemInstruction=i),(t==null?void 0:t.topP)!==void 0&&o.generationConfig&&(o.generationConfig.topP=t.topP),t!=null&&t.stopSequences&&o.generationConfig&&(o.generationConfig.stopSequences=t.stopSequences);try{let d=`${this.config.endpoint}/models/${this.modelId}:generateContent?key=${this.apiKey}`,f=await this.makeRequest({url:d,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return f.error?{success:!1,content:"",error:f.error.message}:{success:!0,content:(v=(p=(g=(h=(u=f.candidates)==null?void 0:u[0])==null?void 0:h.content)==null?void 0:g.parts)==null?void 0:p.map(Y=>Y.text).join(""))!=null?v:"",usage:f.usageMetadata?{inputTokens:f.usageMetadata.promptTokenCount,outputTokens:f.usageMetadata.candidatesTokenCount,totalTokens:f.usageMetadata.promptTokenCount+f.usageMetadata.candidatesTokenCount}:void 0}}catch(d){return this.handleError(d)}}convertMessages(e){let t=[],n=null;for(let i of e)i.role==="system"?n={parts:[{text:i.content}]}:t.push({role:i.role==="assistant"?"model":"user",parts:[{text:i.content}]});return{contents:t,systemInstruction:n}}};var Q=class extends I{constructor(){super(...arguments);this.providerType="grok";this.name="xAI Grok"}async testApiKey(e){try{let t=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.config.defaultModel,messages:[{role:"user",content:"Hello"}],max_tokens:10})});return!t.error&&t.choices&&t.choices.length>0}catch(t){return!1}}async generate(e,t){var o,r,c,u,h,g;if(!this.isAvailable())return{success:!1,content:"",error:"API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."};let n=e.map(p=>({role:p.role,content:p.content})),i={model:this.modelId,messages:n,max_tokens:(o=t==null?void 0:t.maxTokens)!=null?o:4096,temperature:(r=t==null?void 0:t.temperature)!=null?r:.7};(t==null?void 0:t.topP)!==void 0&&(i.top_p=t.topP),t!=null&&t.stopSequences&&(i.stop=t.stopSequences);try{let p=await this.makeRequest({url:`${this.config.endpoint}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(i)});return p.error?{success:!1,content:"",error:p.error.message}:{success:!0,content:(g=(h=(u=(c=p.choices)==null?void 0:c[0])==null?void 0:u.message)==null?void 0:h.content)!=null?g:"",usage:p.usage?{inputTokens:p.usage.prompt_tokens,outputTokens:p.usage.completion_tokens,totalTokens:p.usage.total_tokens}:void 0}}catch(p){return this.handleError(p)}}};var l=require("obsidian");var b=(t=>(t.GENTLE="GENTLE",t.MODERATE="MODERATE",t.CHALLENGING="CHALLENGING",t))(b||{}),k={GENTLE:{displayText:"Gentle",promptModifier:"with a friendly and encouraging tone, guiding exploration in a low-pressure way",description:"Encourages exploration with gentle, supportive guidance.",cssClass:"intensity-gentle"},MODERATE:{displayText:"Moderate",promptModifier:"with a balanced tone that is appropriately challenging yet constructive",description:"Presents balanced, challenging questions.",cssClass:"intensity-moderate"},CHALLENGING:{displayText:"Challenging",promptModifier:"with a direct and sharp tone, probing deeply into argument weaknesses",description:"Strongly examines arguments and identifies weaknesses.",cssClass:"intensity-challenging"}},T=class a{constructor(s){this.value=s}static create(s){let e=typeof s=="string"?b[s]:s;if(!e||!Object.values(b).includes(e))throw new Error(`Invalid intensity level: ${s}`);return new a(e)}static all(){return Object.values(b).map(s=>new a(s))}static default(){return new a("MODERATE")}getValue(){return this.value}getDisplayText(){return k[this.value].displayText}getPromptModifier(){return k[this.value].promptModifier}getDescription(){return k[this.value].description}getCssClass(){return k[this.value].cssClass}getInfo(){return{level:this.value,...k[this.value]}}equals(s){return this.value===s.value}toString(){return this.value}};var C=(i=>(i.ASSUMPTION="ASSUMPTION",i.PERSPECTIVE="PERSPECTIVE",i.EXPANSION="EXPANSION",i.CLARIFICATION="CLARIFICATION",i.IMPLICATION="IMPLICATION",i))(C||{}),R={ASSUMPTION:{displayText:"Assumption",icon:"\u{1F50D}",promptHint:"Generate questions that examine hidden premises or assumptions in this claim.",description:"Examines hidden premises and taken-for-granted assumptions."},PERSPECTIVE:{displayText:"Perspective",icon:"\u{1F441}\uFE0F",promptHint:"Generate questions that view this idea from different perspectives or angles.",description:"Explores viewpoints from different positions or timeframes."},EXPANSION:{displayText:"Expansion",icon:"\u{1F310}",promptHint:"Generate questions that connect or expand this idea in broader contexts.",description:"Explores connections with broader contexts and other domains."},CLARIFICATION:{displayText:"Clarification",icon:"\u{1F4A1}",promptHint:"Generate questions that clarify ambiguous or unclear parts.",description:"Clarifies ambiguous concepts or expressions."},IMPLICATION:{displayText:"Implication",icon:"\u{1F3AF}",promptHint:"Generate questions that explore conclusions, impacts, and limitations of this idea.",description:"Explores logical conclusions and practical impacts."}},m=class a{constructor(s){this.value=s}static create(s){let e=typeof s=="string"?C[s]:s;if(!e||!Object.values(C).includes(e))throw new Error(`Invalid question type: ${s}`);return new a(e)}static all(){return Object.values(C).map(s=>new a(s))}getValue(){return this.value}getDisplayText(){return R[this.value].displayText}getIcon(){return R[this.value].icon}getPromptHint(){return R[this.value].promptHint}getDescription(){return R[this.value].description}getInfo(){return{type:this.value,...R[this.value]}}equals(s){return this.value===s.value}toString(){return this.value}};var w=class a{constructor(s,e,t,n){this._id=s;this._type=e;this._content=t;this._createdAt=n}static create(s,e){let t=s instanceof m?s:m.create(s);return new a(a.generateId(),t,e,new Date)}static fromData(s){return new a(s.id,m.create(s.type),s.content,new Date(s.createdAt))}static generateId(){return`q_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}get id(){return this._id}get type(){return this._type}get content(){return this._content}get createdAt(){return this._createdAt}getTypeDisplayText(){return this._type.getDisplayText()}getTypeIcon(){return this._type.getIcon()}toData(){return{id:this._id,type:this._type.getValue(),content:this._content,createdAt:this._createdAt.getTime()}}toMarkdown(){let s=this._type.getIcon(),e=this._type.getDisplayText();return`**${s} ${e}**: ${this._content}`}};var S=class a{constructor(s,e,t,n,i,o){this._id=s;this._noteId=e;this._notePath=t;this._noteContext=n;this._intensity=i;this._createdAt=o;this._questions=[];this._responses=new Map;this._extractedInsights=null;this._updatedAt=this._createdAt}static create(s,e,t,n){return new a(a.generateId(),s,e,t,n!=null?n:T.default(),new Date)}static fromData(s,e){var n;let t=new a(s.id,s.noteId,s.notePath,(n=e!=null?e:s.noteContext)!=null?n:"",T.create(s.intensity),new Date(s.createdAt));return s.questions.forEach(i=>{t._questions.push(w.fromData(i))}),s.responses.forEach(i=>{t._responses.set(i.questionId,i)}),s.extractedInsights&&(t._extractedInsights=s.extractedInsights),t._updatedAt=new Date(s.updatedAt),t}static generateId(){return`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}get id(){return this._id}get noteId(){return this._noteId}get notePath(){return this._notePath}get noteContext(){return this._noteContext}get intensity(){return this._intensity}get questions(){return this._questions}get createdAt(){return this._createdAt}get updatedAt(){return this._updatedAt}get extractedInsights(){return this._extractedInsights}addQuestion(s){this._questions.push(s),this._updatedAt=new Date}addQuestions(s){s.forEach(e=>this._questions.push(e)),this._updatedAt=new Date}addResponse(s,e){if(!this._questions.find(n=>n.id===s))throw new Error(`Question not found: ${s}`);this._responses.set(s,{questionId:s,content:e,createdAt:Date.now()}),this._updatedAt=new Date}getResponse(s){return this._responses.get(s)}setIntensity(s){this._intensity=s,this._updatedAt=new Date}setExtractedInsights(s){this._extractedInsights=s,this._updatedAt=new Date}getHistory(){return this._questions.map(s=>{var t;let e=this._responses.get(s.id);return{question:s,response:(t=e==null?void 0:e.content)!=null?t:null,responseCreatedAt:e?new Date(e.createdAt):null}})}getUnansweredQuestions(){return this._questions.filter(s=>!this._responses.has(s.id))}getAnsweredQuestions(){return this._questions.filter(s=>this._responses.has(s.id))}hasUnansweredQuestions(){return this.getUnansweredQuestions().length>0}getLastExchange(){let s=this.getAnsweredQuestions();if(s.length===0)return null;let e=s[s.length-1],t=this._responses.get(e.id);return t?{question:e,response:t.content}:null}toData(s){let e={id:this._id,noteId:this._noteId,notePath:this._notePath,questions:this._questions.map(t=>t.toData()),responses:Array.from(this._responses.values()),intensity:this._intensity.getValue(),createdAt:this._createdAt.getTime(),updatedAt:this._updatedAt.getTime()};return s!=null&&s.excludeNoteContext||(e.noteContext=this._noteContext),this._extractedInsights&&(e.extractedInsights=this._extractedInsights),e}toMarkdown(){let s=["## Socratic Dialogue","",`**Started**: ${this._createdAt.toLocaleString("en-US")}`,`**Intensity**: ${this._intensity.getDisplayText()}`,"","---",""];return this._questions.forEach((e,t)=>{let n=this._responses.get(e.id);s.push(`### Q${t+1}. ${e.getTypeIcon()} ${e.getTypeDisplayText()}`),s.push(""),s.push(`> ${e.content}`),s.push(""),n&&(s.push("**My Response:**"),s.push(""),s.push(n.content),s.push("")),s.push("---"),s.push("")}),this._extractedInsights&&(s.push("## \u{1F4A1} Extracted Insights"),s.push(""),this._extractedInsights.insights.length>0&&(s.push("### \u{1F50D} Key Insights"),s.push(""),this._extractedInsights.insights.forEach(e=>{let t=this.getCategoryIcon(e.category);s.push(`#### ${t} ${e.title}`),s.push(""),s.push(e.description),s.push("")})),this._extractedInsights.noteTopics.length>0&&(s.push("### \u{1F4DD} Suggested Note Topics"),s.push(""),this._extractedInsights.noteTopics.forEach(e=>{s.push(`#### ${e.title}`),s.push(""),s.push(e.description),e.suggestedTags.length>0&&(s.push(""),s.push(`**Tags**: ${e.suggestedTags.map(t=>`#${t}`).join(" ")}`)),s.push("")})),this._extractedInsights.unansweredQuestions.length>0&&(s.push("### \u2753 Unanswered Questions"),s.push(""),this._extractedInsights.unansweredQuestions.forEach(e=>{s.push(`- ${e}`)}),s.push("")),this._extractedInsights.noteEnhancements.length>0&&(s.push("### \u2728 Suggested Note Enhancements"),s.push(""),this._extractedInsights.noteEnhancements.forEach(e=>{s.push(`- ${e}`)}),s.push(""))),s.join(`
`)}getCategoryIcon(s){return{discovery:"\u{1F4A1}",perspective:"\u{1F52D}",question:"\u2753",connection:"\u{1F517}"}[s]||"\u{1F4A1}"}};var re=`You are an expert in Socratic dialogue.
You generate thought-provoking questions about notes or ideas written by the user.

**Key Principles:**
- Questions must be open-ended and cannot be answered with yes/no.
- Maintain a critical but non-aggressive tone.
- The goal is to expand and deepen the user's thinking.

**Examples by Question Type:**

\u{1F50D} Assumption Challenge (ASSUMPTION):
- "What conditions must be assumed for this claim to be true?"
- "What is the basis for assuming this is always true?"
- "Could there be counterexamples to this assumption?"

\u{1F441}\uFE0F Perspective Shift (PERSPECTIVE):
- "How would someone with the opposite position view this?"
- "Will this perspective still be valid in 10 years?"
- "How might an expert from a different field interpret this?"

\u{1F310} Expansion (EXPANSION):
- "What would happen if this idea were applied to other domains?"
- "What are the limitations of this?"
- "What meaning does this have in a broader context?"

\u{1F4A1} Clarification (CLARIFICATION):
- "How would you define the concept of 'X' more specifically?"
- "How would you express the core of this idea in one sentence?"
- "What is the most important element?"

\u{1F3AF} Implication (IMPLICATION):
- "If this is true, what conclusions follow?"
- "What results would you expect when applied in practice?"
- "What would you have to give up by accepting this claim?"`;function ae(a){var n;let s=a.intensity.getPromptModifier(),e=(n=a.maxQuestions)!=null?n:3,t=a.questionTypes.map(i=>{let o=m.create(i);return`- ${o.getIcon()} ${o.getDisplayText()}: ${o.getPromptHint()}`}).join(`
`);return`Analyze the following note content and generate ${e} questions ${s}.

**Requested Question Types:**
${t}

**Note Content:**
---
${a.noteContent}
---

**Response Format:**
Output each question in the following JSON format:
\`\`\`json
{
  "questions": [
    {"type": "ASSUMPTION", "content": "Question content"},
    {"type": "PERSPECTIVE", "content": "Question content"},
    ...
  ]
}
\`\`\`

Question types must be selected from the requested types only.`}function ce(a){try{let s=a.match(/```(?:json)?\s*([\s\S]*?)```/),e=s?s[1].trim():a.trim(),t=JSON.parse(e);if(!t.questions||!Array.isArray(t.questions))throw new Error("Invalid response format: missing questions array");return t.questions.map(n=>{let i=m.create(n.type);return w.create(i,n.content)})}catch(s){let e=[],t=a.split(`
`);for(let n of t){let i=n.trim();if(i&&i.includes("?")){let o="ASSUMPTION";i.includes("\u{1F50D}")||i.toLowerCase().includes("assumption")?o="ASSUMPTION":i.includes("\u{1F441}\uFE0F")||i.toLowerCase().includes("perspective")?o="PERSPECTIVE":i.includes("\u{1F310}")||i.toLowerCase().includes("expansion")?o="EXPANSION":i.includes("\u{1F4A1}")||i.toLowerCase().includes("clarif")?o="CLARIFICATION":(i.includes("\u{1F3AF}")||i.toLowerCase().includes("implic"))&&(o="IMPLICATION");let r=i.replace(/^[-*â€¢]\s*/,"").replace(/^[ðŸ”ðŸ‘ï¸ðŸŒðŸ’¡ðŸŽ¯]\s*/,"").replace(/^\d+\.\s*/,"").trim();r.length>10&&e.push(w.create(m.create(o),r))}}return e}}var _=class{constructor(s){this.llmProvider=s}async execute(s){var i;if(!s.noteContent.trim())return{questions:[],error:"Note content is empty."};if(s.questionTypes.length===0)return{questions:[],error:"Please select at least one question type."};let e=ae(s),t=await this.llmProvider.simpleGenerate(e,re,{maxTokens:2e3,temperature:.7});if(!t.success)return{questions:[],error:(i=t.error)!=null?i:"LLM request failed.",rawResponse:t.content};let n=ce(t.content);return n.length===0?{questions:[],error:"Failed to generate questions. The note content may be too short or ambiguous.",rawResponse:t.content}:{questions:n,rawResponse:t.content}}};var ue=`You are an expert in Socratic dialogue.
You generate follow-up questions for deeper exploration based on the previous dialogue context.

**Key Principles:**
- Dig into new assumptions or ideas discovered in previous responses.
- Explore areas the user may have overlooked.
- The goal is to deepen thinking one step further.
- Avoid questions that duplicate previous ones.`;function le(a){var u,h,g,p;let s=a.session,e=s.getHistory(),t=s.getLastExchange(),n=s.intensity.getPromptModifier(),i=(u=a.maxQuestions)!=null?u:2,o=e.map((v,d)=>{let f=v.question,K=v.response;return`Q${d+1}. ${f.getTypeIcon()} ${f.content}
${K?`A${d+1}. ${K}`:"(No answer yet)"}`}).join(`

`),c=((h=a.questionTypes)!=null?h:["ASSUMPTION","EXPANSION","IMPLICATION"]).map(v=>{let d=m.create(v);return`- ${d.getIcon()} ${d.getDisplayText()}`}).join(`
`);return`Analyze the following dialogue and generate ${i} follow-up questions ${n}.

**Original Note:**
---
${s.noteContext}
---

**Dialogue So Far:**
---
${o}
---

**Most Recent Exchange:**
Question: ${(g=t==null?void 0:t.question.content)!=null?g:"(None)"}
Response: ${(p=t==null?void 0:t.response)!=null?p:"(None)"}

**Requested Question Types:**
${c}

**Response Format:**
\`\`\`json
{
  "questions": [
    {"type": "EXPANSION", "content": "Follow-up question content"},
    {"type": "IMPLICATION", "content": "Follow-up question content"}
  ]
}
\`\`\`

Dig into new assumptions, implications, or expandable ideas discovered in the user's last response.
Ensure questions do not duplicate those already asked.`}function pe(a){try{let s=a.match(/```(?:json)?\s*([\s\S]*?)```/),e=s?s[1].trim():a.trim(),t=JSON.parse(e);if(!t.questions||!Array.isArray(t.questions))throw new Error("Invalid response format");return t.questions.map(n=>{let i=m.create(n.type);return w.create(i,n.content)})}catch(s){let e=[],t=a.split(`
`);for(let n of t){let i=n.trim();if(i&&i.includes("?")){let o="EXPANSION";i.toLowerCase().includes("assumption")||i.includes("\u{1F50D}")?o="ASSUMPTION":(i.toLowerCase().includes("implic")||i.includes("\u{1F3AF}"))&&(o="IMPLICATION");let r=i.replace(/^[-*â€¢]\s*/,"").replace(/^[ðŸ”ðŸ‘ï¸ðŸŒðŸ’¡ðŸŽ¯]\s*/,"").replace(/^\d+\.\s*/,"").trim();r.length>10&&e.push(w.create(m.create(o),r))}}return e}}var $=class{constructor(s){this.llmProvider=s}async execute(s){var o;if(s.session.getAnsweredQuestions().length===0)return{questions:[],error:"Please answer at least one question before generating follow-up questions."};let t=le(s),n=await this.llmProvider.simpleGenerate(t,ue,{maxTokens:1500,temperature:.7});if(!n.success)return{questions:[],error:(o=n.error)!=null?o:"LLM request failed.",rawResponse:n.content};let i=pe(n.content);return i.length===0?{questions:[],error:"Failed to generate follow-up questions.",rawResponse:n.content}:{questions:i,rawResponse:n.content}}};var de=`You are an expert at analyzing Socratic dialogues to extract key insights.

Analyze the dialogue where the user answered questions about their note to derive:
1. Key insights discovered through the dialogue
2. Topics that could be developed into new permanent notes (Zettelkasten)
3. Questions that remain unresolved
4. Content that would be good to add to the original note

**Insight Categories:**
- discovery: Newly discovered insights or realizations
- perspective: New viewpoints or perspectives
- question: Questions worth further exploration
- connection: Connection points with other concepts

**Principles for Note Topic Suggestions:**
- Atomic: Should contain only one idea
- Standalone: Should be understandable without context
- Linkable: Should be connectable to other notes`;function ge(a){let e=a.getHistory().map((t,n)=>{let i=`Q${n+1}. [${t.question.getTypeDisplayText()}] ${t.question.content}`,o=t.response?`A${n+1}. ${t.response}`:`A${n+1}. (Unanswered)`;return`${i}
${o}`}).join(`

`);return`Analyze the following Socratic dialogue and extract insights.

**Original Note Content:**
---
${a.noteContext}
---

**Question and Answer Dialogue:**
---
${e}
---

**Response Format:**
Respond in the following JSON format:
\`\`\`json
{
  "insights": [
    {
      "title": "Insight title (concise)",
      "description": "Insight description (2-3 sentences)",
      "category": "discovery|perspective|question|connection"
    }
  ],
  "noteTopics": [
    {
      "title": "New note title (concept-focused, no ID format)",
      "description": "Core content this note will cover",
      "suggestedTags": ["tag1", "tag2"]
    }
  ],
  "unansweredQuestions": [
    "Question not yet explored 1",
    "Question to dig deeper into 2"
  ],
  "noteEnhancements": [
    "Content to add to the original note 1",
    "Perspective to supplement 2"
  ]
}
\`\`\`

**Guidelines:**
- insights: 3-5 items
- noteTopics: 2-3 items (only those truly worth developing into new notes)
- unansweredQuestions: 1-3 items
- noteEnhancements: 1-3 items`}function he(a){try{let s=a.match(/```(?:json)?\s*([\s\S]*?)```/),e=s?s[1].trim():a.trim(),t=JSON.parse(e);return{insights:(t.insights||[]).map(n=>({title:n.title||"",description:n.description||"",category:n.category||"discovery"})),noteTopics:(t.noteTopics||[]).map(n=>({title:n.title||"",description:n.description||"",suggestedTags:n.suggestedTags||[]})),unansweredQuestions:t.unansweredQuestions||[],noteEnhancements:t.noteEnhancements||[]}}catch(s){return console.error("Failed to parse insights response:",s),{insights:[],noteTopics:[],unansweredQuestions:[],noteEnhancements:[]}}}var G=class{constructor(s){this.llmProvider=s}async execute(s){var r;let{session:e}=s;if(e.getAnsweredQuestions().length===0)return{insights:[],noteTopics:[],unansweredQuestions:[],noteEnhancements:[],error:"At least one question must be answered to extract insights."};let n=ge(e),i=await this.llmProvider.simpleGenerate(n,de,{maxTokens:3e3,temperature:.7});if(!i.success)return{insights:[],noteTopics:[],unansweredQuestions:[],noteEnhancements:[],error:(r=i.error)!=null?r:"LLM request failed.",rawResponse:i.content};let o=he(i.content);return o.insights.length===0&&o.noteTopics.length===0?{...o,error:"Failed to extract insights. The responses may be too short.",rawResponse:i.content}:{...o,rawResponse:i.content}}};var U=require("obsidian");var V="## Socratic Dialogue",me="> [!abstract]- Socratic Data (Session data - Do not modify)",ye="> ",N=class{constructor(s){this.app=s}async save(s){let e=(0,U.normalizePath)(s.notePath),t=this.app.vault.getAbstractFileByPath(e);if(!t||!(t instanceof this.app.vault.adapter.constructor)){let n=this.app.vault.getFileByPath(e);if(!n)throw new Error(`Note not found: ${e}`);await this.saveToFile(n,s)}else await this.saveToFile(t,s)}async saveToFile(s,e){let t=await this.app.vault.read(s),n=this.updateContentWithSession(t,e);await this.app.vault.modify(s,n)}updateContentWithSession(s,e){var p;let t=e.toMarkdown(),n=JSON.stringify(e.toData({excludeNoteContext:!0})),i=`
${me}
${ye}${n}
`,o=s.indexOf(V);if(o===-1)return`${s.trim()}

---

${t}${i}`;let r=s.substring(o),c=r.match(/\n## [^\n]+/),u=c?o+((p=c.index)!=null?p:r.length):s.length,h=s.substring(0,o),g=s.substring(u);return`${h.trim()}

${t}${i}
${g.trim()}`.trim()+`
`}async findByNoteId(s){let e=await this.getHistory(s);return e.length>0?e[0]:null}async getHistory(s){let e=this.app.vault.getFileByPath((0,U.normalizePath)(s));if(!e)return[];try{let t=await this.app.vault.read(e),n=this.extractNoteContext(t);return this.parseSessionsFromContent(t,n)}catch(t){return[]}}extractNoteContext(s){let e=s.indexOf(V);if(e===-1)return s;let t=s.lastIndexOf("---",e);return t>0?s.substring(0,t).trim():s.substring(0,e).trim()}parseSessionsFromContent(s,e){let t=[],n=/> \[!abstract\]- Socratic Data[^\n]*\n> (\{[\s\S]*?\})(?=\n(?!>)|$)/g,i;for(;(i=n.exec(s))!==null;)try{let o=i[1].trim(),r=JSON.parse(o);t.push(S.fromData(r,e))}catch(o){console.warn("Failed to parse dialogue session data")}return t}async delete(s){let e=this.app.vault.getMarkdownFiles();for(let t of e){let n=await this.app.vault.read(t);if(n.includes(s)){let i=new RegExp(`> \\[!abstract\\]- Socratic Data[^\\n]*\\n> [^\\n]*"id"\\s*:\\s*"${s}"[^\\n]*\\n?`,"g"),o=n.replace(i,"");if(o.includes("> [!abstract]- Socratic Data"))await this.app.vault.modify(t,o);else{let r=new RegExp(`\\n*---\\n*\\n*${V}[\\s\\S]*$`,""),c=o.replace(r,"").trim()+`
`;await this.app.vault.modify(t,c)}break}}}};var O=class extends l.Modal{constructor(e,t,n,i){super(e);this.session=null;this.responseInputs=new Map;this.questionContainer=null;this.actionsContainer=null;this.insightsContainer=null;this.isLoading=!1;this.extractedInsights=null;this.plugin=t,this.noteContent=n,this.notePath=i,this.noteId=i,this.selectedTypes=[...t.settings.dialogue.defaultQuestionTypes],this.selectedIntensity=T.create(t.settings.dialogue.defaultIntensity),this.questionCount=t.settings.dialogue.defaultQuestionCount}async onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("socratic-challenger-modal"),this.renderHeader(e),this.renderNoteContext(e),this.renderControls(e),this.renderQuestionArea(e),this.renderInsightsArea(e),this.renderActions(e),await this.checkForPreviousDialogue()}onClose(){this.contentEl.empty(),this.responseInputs.clear()}renderHeader(e){let t=e.createDiv({cls:"socratic-header"});t.createEl("h2",{text:"\u{1F3DB}\uFE0F Socratic Challenger"}),t.createEl("p",{text:"Deep questions to challenge and expand your ideas.",cls:"socratic-subtitle"})}renderNoteContext(e){let t=e.createDiv({cls:"socratic-note-context"});t.createEl("h4",{text:"\u{1F4DD} Note Content"});let n=this.noteContent.length>500?this.noteContent.substring(0,500)+"...":this.noteContent;t.createDiv({cls:"note-content",text:n})}renderControls(e){let t=e.createDiv({cls:"socratic-controls"});new l.Setting(t).setName("Question Intensity").addDropdown(i=>{T.all().forEach(o=>{i.addOption(o.getValue(),o.getDisplayText())}),i.setValue(this.selectedIntensity.getValue()),i.onChange(o=>{this.selectedIntensity=T.create(o)})}),new l.Setting(t).setName("Question Count").addDropdown(i=>{for(let o=1;o<=5;o++)i.addOption(o.toString(),`${o}`);i.setValue(this.questionCount.toString()),i.onChange(o=>{this.questionCount=parseInt(o)})});let n=t.createDiv({cls:"socratic-question-types"});n.createEl("span",{text:"Question Types: "}),m.all().forEach(i=>{let o=i.getInfo(),r=n.createEl("label",{cls:"question-type-toggle"}),c=r.createEl("input",{type:"checkbox"});c.checked=this.selectedTypes.includes(o.type),c.addEventListener("change",()=>{if(c.checked)this.selectedTypes.includes(o.type)||this.selectedTypes.push(o.type);else{let u=this.selectedTypes.indexOf(o.type);u>-1&&this.selectedTypes.splice(u,1)}}),r.createSpan({text:o.displayText})})}renderQuestionArea(e){this.questionContainer=e.createDiv({cls:"socratic-question-list"}),this.session||this.questionContainer.createDiv({cls:"socratic-empty-state",text:'Click "Generate Questions" to start.'})}renderInsightsArea(e){this.insightsContainer=e.createDiv({cls:"socratic-insights-area"})}renderActions(e){this.actionsContainer=e.createDiv({cls:"socratic-actions"}),this.updateActionButtons()}updateActionButtons(){this.actionsContainer&&(this.actionsContainer.empty(),this.session?(new l.ButtonComponent(this.actionsContainer).setButtonText("\u{1F4AC} Follow-up Questions").onClick(()=>this.continueDialogue()),new l.ButtonComponent(this.actionsContainer).setButtonText("\u{1F4A1} Extract Insights").onClick(()=>this.extractInsights()),new l.ButtonComponent(this.actionsContainer).setButtonText("\u{1F4BE} Save Dialogue").onClick(()=>this.saveDialogue()),new l.ButtonComponent(this.actionsContainer).setButtonText("\u{1F504} Start Over").onClick(()=>this.resetDialogue())):new l.ButtonComponent(this.actionsContainer).setButtonText("\u{1F3AF} Generate Questions").setCta().onClick(()=>this.generateQuestions()))}async generateQuestions(){if(this.isLoading)return;if(this.selectedTypes.length===0){new l.Notice("Please select at least one question type.");return}let e=this.plugin.getCurrentProvider();if(!e){new l.Notice("AI provider not configured. Please enter API key in settings.");return}this.setLoading(!0);try{let n=await new _(e).execute({noteContent:this.noteContent,questionTypes:this.selectedTypes,intensity:this.selectedIntensity,maxQuestions:this.questionCount});if(n.error){new l.Notice(`Error: ${n.error}`);return}this.session=S.create(this.noteId,this.notePath,this.noteContent,this.selectedIntensity),this.session.addQuestions(n.questions),this.renderQuestions(),this.updateActionButtons(),new l.Notice(`${n.questions.length} questions generated.`)}catch(t){let n=t instanceof Error?t.message:"Failed to generate questions.";new l.Notice(`Error: ${n}`)}finally{this.setLoading(!1)}}async continueDialogue(){if(this.isLoading||!this.session)return;if(this.session.getAnsweredQuestions().length===0){new l.Notice("Please answer at least one question to generate follow-ups.");return}let e=this.plugin.getCurrentProvider();if(!e){new l.Notice("AI provider not configured.");return}this.setLoading(!0);try{let n=await new $(e).execute({session:this.session,maxQuestions:2});if(n.error){new l.Notice(`Error: ${n.error}`);return}this.session.addQuestions(n.questions),this.renderQuestions(),new l.Notice(`${n.questions.length} follow-up questions generated.`)}catch(t){let n=t instanceof Error?t.message:"Failed to generate follow-up questions.";new l.Notice(`Error: ${n}`)}finally{this.setLoading(!1)}}async extractInsights(){if(this.isLoading||!this.session)return;if(this.session.getAnsweredQuestions().length===0){new l.Notice("Please answer at least one question to extract insights.");return}let e=this.plugin.getCurrentProvider();if(!e){new l.Notice("AI provider not configured.");return}this.setLoading(!0,"Extracting insights...");try{let n=await new G(e).execute({session:this.session});if(n.error){new l.Notice(`Error: ${n.error}`);return}this.extractedInsights=n,this.session.setExtractedInsights({insights:n.insights,noteTopics:n.noteTopics,unansweredQuestions:n.unansweredQuestions,noteEnhancements:n.noteEnhancements,extractedAt:Date.now()}),this.renderInsights();let i=n.insights.length+n.noteTopics.length;new l.Notice(`Extracted ${i} insights and topics.`)}catch(t){let n=t instanceof Error?t.message:"Failed to extract insights.";new l.Notice(`Error: ${n}`)}finally{this.setLoading(!1),this.renderQuestions()}}renderInsights(){if(!this.insightsContainer||!this.extractedInsights)return;this.insightsContainer.empty();let{insights:e,noteTopics:t,unansweredQuestions:n,noteEnhancements:i}=this.extractedInsights;if(this.insightsContainer.createEl("h3",{text:"\u{1F4A1} Extracted Insights",cls:"insights-header"}),e.length>0){let o=this.insightsContainer.createDiv({cls:"insights-section"});o.createEl("h4",{text:"\u{1F50D} Key Insights"}),e.forEach(r=>{let c=o.createDiv({cls:`insight-item insight-${r.category}`}),u=this.getCategoryIcon(r.category);c.createDiv({cls:"insight-title",text:`${u} ${r.title}`}),c.createDiv({cls:"insight-description",text:r.description})})}if(t.length>0){let o=this.insightsContainer.createDiv({cls:"insights-section"});o.createEl("h4",{text:"\u{1F4DD} Suggested Note Topics"}),t.forEach(r=>{let c=o.createDiv({cls:"note-topic-item"});if(c.createDiv({cls:"topic-title",text:r.title}),c.createDiv({cls:"topic-description",text:r.description}),r.suggestedTags.length>0){let u=c.createDiv({cls:"topic-tags"});r.suggestedTags.forEach(h=>{u.createSpan({cls:"topic-tag",text:`#${h}`})})}})}if(n.length>0){let o=this.insightsContainer.createDiv({cls:"insights-section"});o.createEl("h4",{text:"\u2753 Unanswered Questions"});let r=o.createEl("ul",{cls:"unanswered-questions"});n.forEach(c=>{r.createEl("li",{text:c})})}if(i.length>0){let o=this.insightsContainer.createDiv({cls:"insights-section"});o.createEl("h4",{text:"\u2728 Suggested Note Enhancements"});let r=o.createEl("ul",{cls:"note-enhancements"});i.forEach(c=>{r.createEl("li",{text:c})})}}getCategoryIcon(e){return{discovery:"\u{1F4A1}",perspective:"\u{1F52D}",question:"\u2753",connection:"\u{1F517}"}[e]||"\u{1F4A1}"}renderQuestions(){if(!this.questionContainer||!this.session)return;this.questionContainer.empty(),this.responseInputs.clear(),this.session.questions.forEach((t,n)=>{this.renderQuestionItem(t,n)})}renderQuestionItem(e,t){if(!this.questionContainer||!this.session)return;let n=`question-type-${e.type.getValue().toLowerCase()}`,i=this.questionContainer.createDiv({cls:`socratic-question-item ${n}`});i.createDiv({cls:"question-type",text:`${e.getTypeIcon()} ${e.getTypeDisplayText()}`}),i.createDiv({cls:"question-content",text:`Q${t+1}. ${e.content}`});let o=this.session.getResponse(e.id);if(o){let r=i.createDiv({cls:"socratic-response-saved"}),c=r.createDiv({cls:"response-header"});c.createSpan({cls:"response-label",text:"My Response:"});let u=new l.ButtonComponent(c);u.setButtonText("\u270F\uFE0F Edit"),u.setClass("response-edit-btn"),u.onClick(()=>this.showEditMode(e.id,o.content,i,t)),r.createDiv({cls:"response-content",text:o.content})}else this.renderResponseInput(e.id,"",i)}renderResponseInput(e,t,n){let i=n.querySelector(".socratic-response-area");i&&i.remove();let o=n.querySelector(".socratic-response-saved");o&&o.remove();let r=n.createDiv({cls:"socratic-response-area"}),c=new l.TextAreaComponent(r);c.setPlaceholder("Write your thoughts on this question..."),c.setValue(t),c.inputEl.rows=3,this.responseInputs.set(e,c);let u=r.createDiv({cls:"response-btn-container"}),h=new l.ButtonComponent(u);if(h.setButtonText(t?"Save Edit":"Save Response"),h.onClick(()=>this.saveResponse(e)),t){let g=new l.ButtonComponent(u);g.setButtonText("Cancel"),g.onClick(()=>this.renderQuestions())}}showEditMode(e,t,n,i){this.renderResponseInput(e,t,n)}saveResponse(e){if(!this.session)return;let t=this.responseInputs.get(e);if(!t)return;let n=t.getValue().trim();if(!n){new l.Notice("Please enter a response.");return}let i=!!this.session.getResponse(e);try{this.session.addResponse(e,n),this.renderQuestions(),new l.Notice(i?"Response updated.":"Response saved.")}catch(o){let r=o instanceof Error?o.message:"Failed to save response.";new l.Notice(`Error: ${r}`)}}async saveDialogue(){if(this.session)try{await new N(this.app).save(this.session),new l.Notice("Dialogue saved to note.")}catch(e){let t=e instanceof Error?e.message:"Failed to save dialogue.";new l.Notice(`Error: ${t}`)}}resetDialogue(){this.session=null,this.responseInputs.clear(),this.questionContainer&&(this.questionContainer.empty(),this.questionContainer.createDiv({cls:"socratic-empty-state",text:'Click "Generate Questions" to start.'})),this.updateActionButtons(),new l.Notice("Dialogue reset.")}setLoading(e,t){if(this.isLoading=e,this.questionContainer&&e){this.questionContainer.empty();let n=this.questionContainer.createDiv({cls:"socratic-loading"});n.createSpan({cls:"loading-spinner",text:"\u23F3"}),n.createSpan({text:t||"Generating questions..."})}}async checkForPreviousDialogue(){try{let t=await new N(this.app).findByNoteId(this.noteId);if(t&&this.questionContainer){this.questionContainer.empty();let n=this.questionContainer.createDiv({cls:"socratic-previous-dialogue"});n.createEl("h4",{text:"\u{1F4DA} Previous Dialogue Found"});let i=n.createDiv({cls:"previous-info"}),o=t.questions.length,r=t.getAnsweredQuestions().length,c=new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});i.createDiv({text:`Created: ${c}`,cls:"previous-date"}),i.createDiv({text:`${r} of ${o} questions answered`,cls:"previous-stats"});let u=n.createDiv({cls:"previous-actions"});new l.ButtonComponent(u).setButtonText("\u{1F4D6} Load Previous Dialogue").setCta().onClick(()=>this.loadPreviousDialogue(t)),new l.ButtonComponent(u).setButtonText("\u{1F195} Start New").onClick(()=>this.startNewDialogue())}}catch(e){console.warn("Failed to check for previous dialogue:",e)}}loadPreviousDialogue(e){this.session=e,this.selectedIntensity=e.intensity,e.extractedInsights&&(this.extractedInsights={insights:e.extractedInsights.insights,noteTopics:e.extractedInsights.noteTopics,unansweredQuestions:e.extractedInsights.unansweredQuestions,noteEnhancements:e.extractedInsights.noteEnhancements},this.renderInsights()),this.renderQuestions(),this.updateActionButtons(),new l.Notice("Previous dialogue loaded.")}startNewDialogue(){this.questionContainer&&(this.questionContainer.empty(),this.questionContainer.createDiv({cls:"socratic-empty-state",text:'Click "Generate Questions" to start.'}))}};var y=require("obsidian");var D=class extends y.PluginSettingTab{constructor(e,t){super(e,t);this.modelDropdown=null;this.plugin=t}display(){let{containerEl:e}=this;e.empty(),this.renderAISettings(e),this.renderDialogueSettings(e)}renderAISettings(e){e.createEl("h2",{text:"AI Settings"}),new y.Setting(e).setName("AI Provider").setDesc("Select the AI service to use").addDropdown(n=>{Object.entries(x).forEach(([i,o])=>{n.addOption(i,o.displayName)}),n.setValue(this.plugin.settings.ai.provider),n.onChange(async i=>{this.plugin.settings.ai.provider=i,await this.plugin.saveSettings(),this.updateModelDropdown(),this.display()})});let t=this.plugin.settings.ai.provider;new y.Setting(e).setName(`${x[t].displayName} API Key`).setDesc("Enter your API key").addText(n=>{var i;n.setPlaceholder("Enter API key").setValue((i=this.plugin.settings.ai.apiKeys[t])!=null?i:"").onChange(async o=>{this.plugin.settings.ai.apiKeys[t]=o,await this.plugin.saveSettings()}),n.inputEl.type="password"}).addButton(n=>{n.setButtonText("Test").onClick(async()=>{let i=this.plugin.getCurrentProvider(),o=this.plugin.settings.ai.apiKeys[t];if(!i){new y.Notice("Provider not found.");return}if(!o){new y.Notice("Please enter an API key first.");return}n.setDisabled(!0),n.setButtonText("Testing...");try{await i.testApiKey(o)?new y.Notice("\u2705 API key is valid!"):new y.Notice("\u274C API key is invalid.")}catch(r){let c=r instanceof Error?r.message:"Unknown error";new y.Notice(`\u274C Test failed: ${c}`)}finally{n.setDisabled(!1),n.setButtonText("Test")}})}),new y.Setting(e).setName("Model").setDesc("Select the model to use").addDropdown(n=>{var i;this.modelDropdown=n,this.populateModelDropdown(n,t),n.setValue((i=this.plugin.settings.ai.models[t])!=null?i:x[t].defaultModel),n.onChange(async o=>{this.plugin.settings.ai.models[t]=o,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Budget Limit (USD)").setDesc("Set monthly API usage budget limit (optional)").addText(n=>{var i,o;n.setPlaceholder("e.g., 10.00").setValue((o=(i=this.plugin.settings.ai.budgetLimit)==null?void 0:i.toString())!=null?o:"").onChange(async r=>{let c=parseFloat(r);this.plugin.settings.ai.budgetLimit=isNaN(c)?void 0:c,await this.plugin.saveSettings()})})}renderDialogueSettings(e){e.createEl("h2",{text:"Dialogue Settings"}),new y.Setting(e).setName("Default Question Intensity").setDesc("Select the default intensity for questions").addDropdown(n=>{T.all().forEach(i=>{n.addOption(i.getValue(),i.getDisplayText())}),n.setValue(this.plugin.settings.dialogue.defaultIntensity),n.onChange(async i=>{this.plugin.settings.dialogue.defaultIntensity=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Default Question Types").setDesc("Select question types to enable by default");let t=e.createDiv({cls:"socratic-question-types-container"});m.all().forEach(n=>{let i=n.getInfo();new y.Setting(t).setName(`${i.icon} ${i.displayText}`).setDesc(i.description).addToggle(o=>{o.setValue(this.plugin.settings.dialogue.defaultQuestionTypes.includes(i.type)).onChange(async r=>{let c=this.plugin.settings.dialogue.defaultQuestionTypes;if(r)c.includes(i.type)||c.push(i.type);else{let u=c.indexOf(i.type);u>-1&&c.splice(u,1)}await this.plugin.saveSettings()})})}),new y.Setting(e).setName("Default Question Count").setDesc("Default number of questions to generate at a time (1-5)").addSlider(n=>{n.setLimits(1,5,1).setValue(this.plugin.settings.dialogue.defaultQuestionCount).setDynamicTooltip().onChange(async i=>{this.plugin.settings.dialogue.defaultQuestionCount=i,await this.plugin.saveSettings()})}),new y.Setting(e).setName("Auto Save").setDesc("Automatically save dialogue to the note").addToggle(n=>{n.setValue(this.plugin.settings.dialogue.autoSaveDialogue).onChange(async i=>{this.plugin.settings.dialogue.autoSaveDialogue=i,await this.plugin.saveSettings()})})}populateModelDropdown(e,t){J(t).forEach(i=>{e.addOption(i.id,i.displayName)})}updateModelDropdown(){var t;if(!this.modelDropdown)return;let e=this.plugin.settings.ai.provider;this.modelDropdown.selectEl.empty(),this.populateModelDropdown(this.modelDropdown,e),this.modelDropdown.setValue((t=this.plugin.settings.ai.models[e])!=null?t:x[e].defaultModel)}};var A={ai:{provider:"claude",apiKeys:{},models:{claude:"claude-sonnet-4-5-20250929",openai:"gpt-5.2",gemini:"gemini-3-flash-preview",grok:"grok-4-1-fast"},budgetLimit:void 0},dialogue:{defaultIntensity:"MODERATE",defaultQuestionTypes:["ASSUMPTION","PERSPECTIVE","EXPANSION"],defaultQuestionCount:3,autoSaveDialogue:!0}};var F=class extends P.Plugin{constructor(){super(...arguments);this.aiService=null}async onload(){await this.loadSettings(),this.initializeAIService(),this.addCommand({id:"start-socratic-dialogue",name:"Start Socratic Dialogue",callback:()=>this.startDialogue()}),this.addRibbonIcon("message-circle","Socratic Challenger",()=>{this.startDialogue()}),this.addSettingTab(new D(this.app,this)),console.log("Socratic Challenger plugin loaded")}async onunload(){console.log("Socratic Challenger plugin unloaded")}async loadSettings(){let e=await this.loadData();this.settings={...A,ai:{...A.ai,apiKeys:{...A.ai.apiKeys},models:{...A.ai.models}},dialogue:{...A.dialogue,defaultQuestionTypes:[...A.dialogue.defaultQuestionTypes]}},e&&(e.ai&&(e.ai.provider&&(this.settings.ai.provider=e.ai.provider),e.ai.apiKeys&&(this.settings.ai.apiKeys={...this.settings.ai.apiKeys,...e.ai.apiKeys}),e.ai.models&&(this.settings.ai.models={...this.settings.ai.models,...e.ai.models}),e.ai.budgetLimit!==void 0&&(this.settings.ai.budgetLimit=e.ai.budgetLimit)),e.dialogue&&(e.dialogue.defaultIntensity&&(this.settings.dialogue.defaultIntensity=e.dialogue.defaultIntensity),e.dialogue.defaultQuestionTypes&&(this.settings.dialogue.defaultQuestionTypes=e.dialogue.defaultQuestionTypes),e.dialogue.defaultQuestionCount!==void 0&&(this.settings.dialogue.defaultQuestionCount=e.dialogue.defaultQuestionCount),e.dialogue.autoSaveDialogue!==void 0&&(this.settings.dialogue.autoSaveDialogue=e.dialogue.autoSaveDialogue)))}async saveSettings(){await this.saveData(this.settings),this.updateAIService()}initializeAIService(){this.aiService=j(this.settings.ai),[["claude",new L],["openai",new M],["gemini",new q],["grok",new Q]].forEach(([t,n])=>{var r,c;let i=this.settings.ai.apiKeys[t];i&&n.setApiKey(i);let o=(r=this.settings.ai.models[t])!=null?r:x[t].defaultModel;n.setModel(o),(c=this.aiService)==null||c.registerProvider(t,n)})}updateAIService(){W(this.settings.ai);let e=z();e&&["claude","openai","gemini","grok"].forEach(t=>{var i;let n=e.providers.get(t);if(n){let o=this.settings.ai.apiKeys[t];o&&n.setApiKey(o);let r=(i=this.settings.ai.models[t])!=null?i:x[t].defaultModel;n.setModel(r)}})}getCurrentProvider(){var e;return(e=this.aiService)==null?void 0:e.getCurrentProvider()}async startDialogue(){let e=this.app.workspace.getActiveFile();if(!e){new P.Notice("Please open a note first.");return}await this.startDialogueForFile(e)}async startDialogueForFile(e){var t;if(!((t=this.aiService)!=null&&t.isAvailable())){new P.Notice("Please configure AI settings first. (Settings \u2192 Socratic Challenger)");return}try{let n=await this.app.vault.read(e);if(!n.trim()){new P.Notice("Note content is empty.");return}new O(this.app,this,n,e.path).open()}catch(n){let i=n instanceof Error?n.message:"Unable to read note.";new P.Notice(`Error: ${i}`)}}};
